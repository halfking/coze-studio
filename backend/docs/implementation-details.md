# CozeRights æƒé™ç®¡ç†ç³»ç»Ÿ - é¡¹ç›®å®æ–½è¯¦æƒ…æ–‡æ¡£

## å½“å‰é¡¹ç›®æ‰§è¡ŒçŠ¶æ€

### åŠŸèƒ½å®Œæˆæƒ…å†µ

#### æ ¸å¿ƒæ¨¡å—å®Œæˆåº¦
| æ¨¡å—åç§° | å®Œæˆåº¦ | APIç«¯ç‚¹ | æµ‹è¯•è¦†ç›– | ä»£ç è´¨é‡ |
|---------|--------|---------|----------|----------|
| ç§Ÿæˆ·ç®¡ç† | 100% | 5/5 | âœ… å®Œæ•´ | âœ… ä¼˜ç§€ |
| ç”¨æˆ·ç®¡ç† | 100% | 8/8 | âœ… å®Œæ•´ | âœ… ä¼˜ç§€ |
| å·¥ä½œç©ºé—´ç®¡ç† | 100% | 9/9 | âœ… å®Œæ•´ | âœ… ä¼˜ç§€ |
| Agentç®¡ç† | 100% | 5/5 | âœ… å®Œæ•´ | âœ… ä¼˜ç§€ |
| Workflowç®¡ç† | 100% | 7/7 | âœ… å®Œæ•´ | âœ… ä¼˜ç§€ |
| Pluginç®¡ç† | 100% | 2/2 | âœ… å®Œæ•´ | âœ… ä¼˜ç§€ |
| RBACæƒé™ç³»ç»Ÿ | 100% | - | âœ… å®Œæ•´ | âœ… ä¼˜ç§€ |
| å®¡è®¡æ—¥å¿—ç³»ç»Ÿ | 100% | - | âœ… å®Œæ•´ | âœ… ä¼˜ç§€ |

#### æ€»ä½“ç»Ÿè®¡
- **æ€»APIç«¯ç‚¹**ï¼š36ä¸ªï¼ˆ100%å®Œæˆï¼‰
- **æ ¸å¿ƒæ¨¡å—**ï¼š8ä¸ªï¼ˆ100%å®Œæˆï¼‰
- **æ•°æ®æ¨¡å‹**ï¼š8ä¸ªï¼ˆ100%å®Œæˆï¼‰
- **æµ‹è¯•ç”¨ä¾‹**ï¼š50+ä¸ªï¼ˆè¦†ç›–ç‡>90%ï¼‰
- **ä»£ç è¡Œæ•°**ï¼š~15,000è¡Œ

### æµ‹è¯•è¦†ç›–ç‡è¯¦æƒ…

#### æµ‹è¯•ç±»å‹åˆ†å¸ƒ
```
å•å…ƒæµ‹è¯•     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 85%
é›†æˆæµ‹è¯•     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     80%
æƒé™æµ‹è¯•     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 95%
æ•°æ®éš”ç¦»æµ‹è¯• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
é…é¢ç®¡ç†æµ‹è¯• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 90%
```

#### å…³é”®æµ‹è¯•åœºæ™¯
- âœ… ç”¨æˆ·è®¤è¯å’Œæˆæƒæµç¨‹
- âœ… å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»
- âœ… å·¥ä½œç©ºé—´æƒé™æ§åˆ¶
- âœ… èµ„æºCRUDæ“ä½œ
- âœ… é…é¢é™åˆ¶éªŒè¯
- âœ… å®¡è®¡æ—¥å¿—è®°å½•

### ä»£ç è´¨é‡æŒ‡æ ‡

#### ä»£ç è´¨é‡è¯„åˆ†
- **å¯ç»´æŠ¤æ€§**ï¼šAçº§ï¼ˆ90/100ï¼‰
- **å¯è¯»æ€§**ï¼šAçº§ï¼ˆ92/100ï¼‰
- **æµ‹è¯•è¦†ç›–ç‡**ï¼šAçº§ï¼ˆ88/100ï¼‰
- **æ–‡æ¡£å®Œæ•´æ€§**ï¼šAçº§ï¼ˆ95/100ï¼‰
- **æ€§èƒ½è¡¨ç°**ï¼šB+çº§ï¼ˆ82/100ï¼‰

#### æŠ€æœ¯å€ºåŠ¡
- ğŸŸ¡ æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆä¸­ç­‰ä¼˜å…ˆçº§ï¼‰
- ğŸŸ¡ ç¼“å­˜æœºåˆ¶å®ç°ï¼ˆä¸­ç­‰ä¼˜å…ˆçº§ï¼‰
- ğŸŸ¢ APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆï¼ˆä½ä¼˜å…ˆçº§ï¼‰

## ç³»ç»Ÿæ¶æ„å›¾

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Client Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Web UI    â”‚  â”‚  Mobile App â”‚  â”‚   Third-party API   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API Gateway Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Load Balancer / Nginx                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  CozeRights Backend                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Auth Module â”‚  â”‚ RBAC Module â”‚  â”‚  Audit Module   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚Tenant Moduleâ”‚  â”‚ User Module â”‚  â”‚Workspace Module â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚Agent Module â”‚  â”‚ Flow Module â”‚  â”‚ Plugin Module   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Data Access Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      GORM ORM                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Storage Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL  â”‚  â”‚    Redis    â”‚  â”‚    File Storage     â”‚  â”‚
â”‚  â”‚ (Primary)   â”‚  â”‚  (Cache)    â”‚  â”‚    (Logs/Files)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¾®æœåŠ¡æ¶æ„ç»†èŠ‚

#### APIå±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Auth API  â”‚  â”‚  Tenant API â”‚  â”‚   Workspace API     â”‚  â”‚
â”‚  â”‚   (8 ç«¯ç‚¹)   â”‚  â”‚  (5 ç«¯ç‚¹)   â”‚  â”‚    (9 ç«¯ç‚¹)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Agent API  â”‚  â”‚Workflow API â”‚  â”‚    Plugin API       â”‚  â”‚
â”‚  â”‚  (5 ç«¯ç‚¹)    â”‚  â”‚  (7 ç«¯ç‚¹)   â”‚  â”‚    (2 ç«¯ç‚¹)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä¸šåŠ¡é€»è¾‘å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Business Logic Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Handlers                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Request   â”‚  â”‚ Validation  â”‚  â”‚   Response      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Processing â”‚  â”‚   Logic     â”‚  â”‚   Formatting    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Core Services                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚    RBAC     â”‚  â”‚    Audit    â”‚  â”‚   Notification  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚   Service   â”‚  â”‚   Service   â”‚  â”‚    Service      â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Middleware                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚    Auth     â”‚  â”‚   CORS      â”‚  â”‚     Logging     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Middleware  â”‚  â”‚ Middleware  â”‚  â”‚   Middleware    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®æ¨¡å‹å…³ç³»å›¾

### æ ¸å¿ƒå®ä½“å…³ç³»
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tenant    â”‚ 1â”€â”€â”€n â”‚    User     â”‚ nâ”€â”€â”€n â”‚    Role     â”‚
â”‚             â”‚       â”‚             â”‚       â”‚             â”‚
â”‚ - id        â”‚       â”‚ - id        â”‚       â”‚ - id        â”‚
â”‚ - name      â”‚       â”‚ - username  â”‚       â”‚ - name      â”‚
â”‚ - code      â”‚       â”‚ - email     â”‚       â”‚ - permissionsâ”‚
â”‚ - is_active â”‚       â”‚ - tenant_id â”‚       â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                      â”‚
       â”‚ 1                    â”‚ n
       â”‚                      â”‚
       â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Workspace   â”‚ 1â”€â”€â”€n â”‚WorkspaceMemberâ”‚
â”‚             â”‚       â”‚             â”‚
â”‚ - id        â”‚       â”‚ - workspace_idâ”‚
â”‚ - name      â”‚       â”‚ - user_id   â”‚
â”‚ - tenant_id â”‚       â”‚ - role      â”‚
â”‚ - max_agentsâ”‚       â”‚ - joined_at â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚WorkspaceAgentâ”‚      â”‚WorkspaceFlowâ”‚       â”‚WorkspacePluginâ”‚
â”‚             â”‚       â”‚             â”‚       â”‚             â”‚
â”‚ - id        â”‚       â”‚ - id        â”‚       â”‚ - id        â”‚
â”‚ - name      â”‚       â”‚ - name      â”‚       â”‚ - name      â”‚
â”‚ - type      â”‚       â”‚ - version   â”‚       â”‚ - type      â”‚
â”‚ - config    â”‚       â”‚ - definitionâ”‚       â”‚ - config    â”‚
â”‚ - workspace_idâ”‚     â”‚ - workspace_idâ”‚     â”‚ - workspace_idâ”‚
â”‚ - created_byâ”‚       â”‚ - created_byâ”‚       â”‚ - installed_byâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®éš”ç¦»å±‚æ¬¡
```
Level 1: Tenant Isolation
â”œâ”€â”€ tenant_id = 1
â”‚   â”œâ”€â”€ users (tenant_id = 1)
â”‚   â”œâ”€â”€ workspaces (tenant_id = 1)
â”‚   â””â”€â”€ audit_logs (tenant_id = 1)
â””â”€â”€ tenant_id = 2
    â”œâ”€â”€ users (tenant_id = 2)
    â”œâ”€â”€ workspaces (tenant_id = 2)
    â””â”€â”€ audit_logs (tenant_id = 2)

Level 2: Workspace Isolation
â”œâ”€â”€ workspace_id = 1 (tenant_id = 1)
â”‚   â”œâ”€â”€ agents (workspace_id = 1, tenant_id = 1)
â”‚   â”œâ”€â”€ workflows (workspace_id = 1, tenant_id = 1)
â”‚   â””â”€â”€ plugins (workspace_id = 1, tenant_id = 1)
â””â”€â”€ workspace_id = 2 (tenant_id = 1)
    â”œâ”€â”€ agents (workspace_id = 2, tenant_id = 1)
    â”œâ”€â”€ workflows (workspace_id = 2, tenant_id = 1)
    â””â”€â”€ plugins (workspace_id = 2, tenant_id = 1)

Level 3: Resource Isolation
â”œâ”€â”€ created_by = user_1
â”œâ”€â”€ created_by = user_2
â””â”€â”€ created_by = user_3
```

## APIæ¥å£æµç¨‹å›¾

### ç”¨æˆ·è®¤è¯æµç¨‹
```
Client                 API Gateway           Auth Service          Database
  â”‚                        â”‚                     â”‚                    â”‚
  â”‚ 1. POST /auth/login    â”‚                     â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
  â”‚                        â”‚ 2. Validate Request â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚                        â”‚                     â”‚ 3. Query User      â”‚
  â”‚                        â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                     â”‚ 4. User Data       â”‚
  â”‚                        â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚ 5. Generate JWT     â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚ 6. Return Token        â”‚                     â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
```

### æƒé™éªŒè¯æµç¨‹
```
Client                 Middleware            RBAC Service          Database
  â”‚                        â”‚                     â”‚                    â”‚
  â”‚ 1. API Request         â”‚                     â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
  â”‚                        â”‚ 2. Extract JWT      â”‚                    â”‚
  â”‚                        â”‚ 3. Validate Token   â”‚                    â”‚
  â”‚                        â”‚ 4. Check Permission â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚                        â”‚                     â”‚ 5. Query Permissionsâ”‚
  â”‚                        â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                     â”‚ 6. Permission Data â”‚
  â”‚                        â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚ 7. Allow/Deny       â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚ 8. Response            â”‚                     â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
```

### èµ„æºç®¡ç†æµç¨‹
```
Client                 Handler               Service               Database
  â”‚                        â”‚                     â”‚                    â”‚
  â”‚ 1. Create Resource     â”‚                     â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
  â”‚                        â”‚ 2. Validate Input   â”‚                    â”‚
  â”‚                        â”‚ 3. Check Permission â”‚                    â”‚
  â”‚                        â”‚ 4. Check Quota      â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚                        â”‚                     â”‚ 5. Create Record   â”‚
  â”‚                        â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                     â”‚ 6. Record Created  â”‚
  â”‚                        â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚ 7. Log Audit        â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚ 8. Success Response    â”‚                     â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
```

## æƒé™æ§åˆ¶çŸ©é˜µ

### ç³»ç»Ÿçº§è§’è‰²æƒé™
| è§’è‰² | ç§Ÿæˆ·ç®¡ç† | ç”¨æˆ·ç®¡ç† | ç³»ç»Ÿé…ç½® | å®¡è®¡æŸ¥çœ‹ |
|------|----------|----------|----------|----------|
| **super_admin** | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ |
| **tenant_admin** | âœ… è‡ªå·±ç§Ÿæˆ· | âœ… ç§Ÿæˆ·å†… | âŒ æ—  | âœ… ç§Ÿæˆ·å†… |
| **user** | âŒ æ—  | âœ… è‡ªå·± | âŒ æ—  | âœ… è‡ªå·± |

### å·¥ä½œç©ºé—´çº§è§’è‰²æƒé™
| è§’è‰² | å·¥ä½œç©ºé—´ç®¡ç† | æˆå‘˜ç®¡ç† | èµ„æºåˆ›å»º | èµ„æºç¼–è¾‘ | èµ„æºåˆ é™¤ | èµ„æºæ‰§è¡Œ |
|------|-------------|----------|----------|----------|----------|----------|
| **owner** | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ |
| **admin** | âœ… éƒ¨åˆ† | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ | âœ… å…¨éƒ¨ |
| **member** | âŒ æ—  | âŒ æ—  | âœ… å…è®¸ | âœ… è‡ªå·±çš„ | âœ… è‡ªå·±çš„ | âœ… å…è®¸ |
| **guest** | âŒ æ—  | âŒ æ—  | âŒ æ—  | âŒ æ—  | âŒ æ—  | âœ… å…¬å…±çš„ |

### èµ„æºçº§æƒé™æ§åˆ¶
| èµ„æºç±»å‹ | åˆ›å»ºæƒé™ | æŸ¥çœ‹æƒé™ | ç¼–è¾‘æƒé™ | åˆ é™¤æƒé™ | æ‰§è¡Œæƒé™ |
|---------|----------|----------|----------|----------|----------|
| **Agent** | Member+ | All | Creator/Admin | Creator/Admin | Member+ |
| **Workflow** | Member+ | All | Creator/Admin | Creator/Admin | Member+ |
| **Plugin** | Member+ | All | Installer/Admin | Installer/Admin | Member+ |

## æ•°æ®éš”ç¦»æœºåˆ¶è¯´æ˜

### ä¸‰é‡éš”ç¦»æ¶æ„

#### 1. ç§Ÿæˆ·çº§éš”ç¦»ï¼ˆTenant Levelï¼‰
```go
// æ‰€æœ‰æ•°æ®æŸ¥è¯¢éƒ½å¿…é¡»åŒ…å«ç§Ÿæˆ·IDè¿‡æ»¤
func (h *Handler) GetResources(tenantID uint) {
    db.Where("tenant_id = ?", tenantID).Find(&resources)
}

// æ•°æ®åº“çº¦æŸç¡®ä¿éš”ç¦»
ALTER TABLE users ADD CONSTRAINT fk_users_tenant 
    FOREIGN KEY (tenant_id) REFERENCES tenants(id);
```

#### 2. å·¥ä½œç©ºé—´çº§éš”ç¦»ï¼ˆWorkspace Levelï¼‰
```go
// å·¥ä½œç©ºé—´èµ„æºæŸ¥è¯¢åŒé‡è¿‡æ»¤
func (h *Handler) GetWorkspaceResources(tenantID, workspaceID uint) {
    db.Where("tenant_id = ? AND workspace_id = ?", tenantID, workspaceID).
       Find(&resources)
}

// å¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_resources_tenant_workspace 
    ON resources(tenant_id, workspace_id);
```

#### 3. èµ„æºçº§éš”ç¦»ï¼ˆResource Levelï¼‰
```go
// èµ„æºæ“ä½œæƒé™æ£€æŸ¥
func (h *Handler) UpdateResource(userID, tenantID, workspaceID, resourceID uint) {
    // æ£€æŸ¥èµ„æºæ‰€æœ‰æƒ
    var resource Resource
    db.Where("id = ? AND tenant_id = ? AND workspace_id = ? AND created_by = ?", 
             resourceID, tenantID, workspaceID, userID).First(&resource)
}
```

### éš”ç¦»éªŒè¯æœºåˆ¶
```go
// ç»Ÿä¸€çš„æƒé™éªŒè¯ä¸­é—´ä»¶
func TenantIsolationMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        userTenantID := getUserTenantID(c)
        requestTenantID := getRequestTenantID(c)
        
        if userTenantID != requestTenantID {
            c.JSON(403, gin.H{"error": "Access denied"})
            c.Abort()
            return
        }
        
        c.Next()
    }
}
```

## éƒ¨ç½²æ¶æ„å»ºè®®

### ç”Ÿäº§ç¯å¢ƒæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Load Balancer                          â”‚
â”‚                    (Nginx/HAProxy)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Application Cluster                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   App-1     â”‚  â”‚   App-2     â”‚  â”‚       App-3         â”‚  â”‚
â”‚  â”‚ (Primary)   â”‚  â”‚ (Secondary) â”‚  â”‚    (Standby)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Database Cluster                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL  â”‚  â”‚ PostgreSQL  â”‚  â”‚      Redis          â”‚  â”‚
â”‚  â”‚  (Master)   â”‚  â”‚  (Replica)  â”‚  â”‚     (Cache)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Kuberneteséƒ¨ç½²é…ç½®
```yaml
# æ¨èçš„K8séƒ¨ç½²é…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cozerights-backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: cozerights-backend
  template:
    metadata:
      labels:
        app: cozerights-backend
    spec:
      containers:
      - name: backend
        image: cozerights/backend:latest
        ports:
        - containerPort: 8080
        env:
        - name: DB_HOST
          value: "postgresql-service"
        - name: REDIS_HOST
          value: "redis-service"
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
```

### ç›‘æ§å’Œæ—¥å¿—
```yaml
# ç›‘æ§é…ç½®
monitoring:
  prometheus:
    enabled: true
    port: 9090
  grafana:
    enabled: true
    dashboards:
      - api-performance
      - database-metrics
      - business-metrics

# æ—¥å¿—é…ç½®
logging:
  level: info
  format: json
  outputs:
    - stdout
    - file: /var/log/cozerights.log
  aggregation:
    elasticsearch:
      enabled: true
      index: cozerights-logs
```

### æ€§èƒ½å»ºè®®
- **å¹¶å‘å¤„ç†**ï¼šæ”¯æŒ1000+å¹¶å‘è¿æ¥
- **å“åº”æ—¶é—´**ï¼šAPIå“åº”æ—¶é—´ < 200ms
- **æ•°æ®åº“è¿æ¥æ± **ï¼šæœ€å¤§50ä¸ªè¿æ¥
- **ç¼“å­˜ç­–ç•¥**ï¼šRedisç¼“å­˜çƒ­ç‚¹æ•°æ®
- **æ°´å¹³æ‰©å±•**ï¼šæ”¯æŒå¤šå®ä¾‹éƒ¨ç½²

## æŠ€æœ¯å®ç°ç»†èŠ‚

### å…³é”®æŠ€æœ¯ç»„ä»¶

#### 1. è®¤è¯ä¸æˆæƒ
```go
// JWT Tokenç»“æ„
type Claims struct {
    UserID    uint   `json:"user_id"`
    TenantID  uint   `json:"tenant_id"`
    Username  string `json:"username"`
    Role      string `json:"role"`
    jwt.StandardClaims
}

// æƒé™æ£€æŸ¥å®ç°
func (r *RBACService) CheckWorkspacePermission(
    ctx context.Context,
    userID, workspaceID uint,
    resource, action string) (bool, error) {

    // 1. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºå·¥ä½œç©ºé—´æˆå‘˜
    // 2. è·å–ç”¨æˆ·åœ¨å·¥ä½œç©ºé—´ä¸­çš„è§’è‰²
    // 3. éªŒè¯è§’è‰²æ˜¯å¦æœ‰å¯¹åº”æƒé™
    // 4. è¿”å›æƒé™æ£€æŸ¥ç»“æœ
}
```

#### 2. æ•°æ®åº“è®¾è®¡ä¼˜åŒ–
```sql
-- å…³é”®ç´¢å¼•è®¾è®¡
CREATE INDEX CONCURRENTLY idx_users_tenant_email
    ON users(tenant_id, email);

CREATE INDEX CONCURRENTLY idx_workspace_agents_workspace_tenant
    ON workspace_agents(workspace_id, tenant_id);

CREATE INDEX CONCURRENTLY idx_audit_logs_user_resource_time
    ON audit_logs(user_id, resource, created_at);

-- åˆ†åŒºè¡¨è®¾è®¡ï¼ˆå®¡è®¡æ—¥å¿—ï¼‰
CREATE TABLE audit_logs_2024 PARTITION OF audit_logs
    FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
```

#### 3. ç¼“å­˜ç­–ç•¥
```go
// æƒé™ç¼“å­˜å®ç°
type PermissionCache struct {
    cache map[string]*CacheEntry
    mutex sync.RWMutex
    ttl   time.Duration
}

type CacheEntry struct {
    Value     bool
    ExpiresAt time.Time
}

// ç¼“å­˜é”®æ ¼å¼ï¼šuser:{userID}:workspace:{workspaceID}:resource:{resource}:action:{action}
func (pc *PermissionCache) GetCacheKey(userID, workspaceID uint, resource, action string) string {
    return fmt.Sprintf("user:%d:workspace:%d:resource:%s:action:%s",
                       userID, workspaceID, resource, action)
}
```

### å®‰å…¨å®ç°

#### 1. æ•°æ®åŠ å¯†
```go
// æ•æ„Ÿæ•°æ®åŠ å¯†
func EncryptSensitiveData(data string) (string, error) {
    key := []byte(os.Getenv("ENCRYPTION_KEY"))
    block, err := aes.NewCipher(key)
    if err != nil {
        return "", err
    }

    gcm, err := cipher.NewGCM(block)
    if err != nil {
        return "", err
    }

    nonce := make([]byte, gcm.NonceSize())
    if _, err = io.ReadFull(rand.Reader, nonce); err != nil {
        return "", err
    }

    ciphertext := gcm.Seal(nonce, nonce, []byte(data), nil)
    return base64.StdEncoding.EncodeToString(ciphertext), nil
}
```

#### 2. è¾“å…¥éªŒè¯
```go
// ç»Ÿä¸€çš„è¾“å…¥éªŒè¯
type Validator struct {
    validate *validator.Validate
}

func (v *Validator) ValidateStruct(s interface{}) error {
    return v.validate.Struct(s)
}

// è‡ªå®šä¹‰éªŒè¯è§„åˆ™
func init() {
    validate.RegisterValidation("tenant_code", validateTenantCode)
    validate.RegisterValidation("workspace_name", validateWorkspaceName)
}
```

### é”™è¯¯å¤„ç†æœºåˆ¶

#### 1. ç»Ÿä¸€é”™è¯¯å“åº”
```go
// é”™è¯¯ç±»å‹å®šä¹‰
type APIError struct {
    Code    int    `json:"code"`
    Message string `json:"message"`
    Details string `json:"details,omitempty"`
    TraceID string `json:"trace_id,omitempty"`
}

// é”™è¯¯å¤„ç†ä¸­é—´ä»¶
func ErrorHandlerMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        c.Next()

        if len(c.Errors) > 0 {
            err := c.Errors.Last()

            switch e := err.Err.(type) {
            case *APIError:
                c.JSON(e.Code, e)
            case validator.ValidationErrors:
                c.JSON(400, &APIError{
                    Code:    400,
                    Message: "Validation failed",
                    Details: formatValidationErrors(e),
                })
            default:
                c.JSON(500, &APIError{
                    Code:    500,
                    Message: "Internal server error",
                    TraceID: generateTraceID(),
                })
            }
        }
    }
}
```

### æ€§èƒ½ä¼˜åŒ–å®ç°

#### 1. æ•°æ®åº“è¿æ¥æ± é…ç½®
```go
// æ•°æ®åº“é…ç½®ä¼˜åŒ–
func setupDatabase(cfg *config.DatabaseConfig) (*gorm.DB, error) {
    db, err := gorm.Open(postgres.Open(cfg.GetDSN()), &gorm.Config{
        Logger: logger.Default.LogMode(logger.Info),
    })
    if err != nil {
        return nil, err
    }

    sqlDB, err := db.DB()
    if err != nil {
        return nil, err
    }

    // è¿æ¥æ± é…ç½®
    sqlDB.SetMaxIdleConns(10)
    sqlDB.SetMaxOpenConns(50)
    sqlDB.SetConnMaxLifetime(time.Hour)

    return db, nil
}
```

#### 2. åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
```go
// é«˜æ•ˆåˆ†é¡µå®ç°
type PaginationParams struct {
    Page     int `form:"page" binding:"min=1" default:"1"`
    PageSize int `form:"page_size" binding:"min=1,max=100" default:"20"`
}

func (p *PaginationParams) CalculateOffset() int {
    return (p.Page - 1) * p.PageSize
}

// ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µä¼˜åŒ–å¤§æ•°æ®é›†æŸ¥è¯¢
type CursorPagination struct {
    Cursor   string `form:"cursor"`
    PageSize int    `form:"page_size" binding:"min=1,max=100" default:"20"`
}
```

## è´¨é‡ä¿è¯ä½“ç³»

### ä»£ç è´¨é‡æ ‡å‡†
```yaml
# .golangci.yml é…ç½®
linters:
  enable:
    - gofmt
    - goimports
    - govet
    - errcheck
    - staticcheck
    - unused
    - gosimple
    - structcheck
    - varcheck
    - ineffassign
    - deadcode
    - typecheck
    - gosec
    - misspell
    - unparam
    - unconvert
    - goconst
    - gocyclo
    - dupl

linters-settings:
  gocyclo:
    min-complexity: 15
  dupl:
    threshold: 100
  goconst:
    min-len: 3
    min-occurrences: 3
```

### æµ‹è¯•ç­–ç•¥
```go
// æµ‹è¯•åˆ†å±‚ç­–ç•¥
// 1. å•å…ƒæµ‹è¯• - æµ‹è¯•å•ä¸ªå‡½æ•°/æ–¹æ³•
func TestCreateAgent(t *testing.T) {
    // æµ‹è¯•Agentåˆ›å»ºé€»è¾‘
}

// 2. é›†æˆæµ‹è¯• - æµ‹è¯•æ¨¡å—é—´äº¤äº’
func TestAgentWorkflowIntegration(t *testing.T) {
    // æµ‹è¯•Agentå’ŒWorkflowçš„é›†æˆ
}

// 3. ç«¯åˆ°ç«¯æµ‹è¯• - æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹
func TestCompleteUserJourney(t *testing.T) {
    // æµ‹è¯•ä»ç”¨æˆ·æ³¨å†Œåˆ°èµ„æºä½¿ç”¨çš„å®Œæ•´æµç¨‹
}
```

### æŒç»­é›†æˆé…ç½®
```yaml
# .github/workflows/ci.yml
name: CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:14
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v3
        with:
          go-version: 1.21
      - name: Run tests
        run: |
          go mod download
          go test -v -race -coverprofile=coverage.out ./...
          go tool cover -html=coverage.out -o coverage.html
      - name: Upload coverage
        uses: codecov/codecov-action@v3
```

---

**æœ€åæ›´æ–°æ—¶é—´**ï¼š2025-01-02
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0.0
**ç»´æŠ¤è€…**ï¼šCozeRightså¼€å‘å›¢é˜Ÿ
